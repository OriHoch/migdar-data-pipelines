download:
  pipeline:
  - run: code
    code: |
      from datapackage_pipelines.wrapper import ingest, spew
      import os
      parameters, datapackage, resources = ingest()
      os.system('mkdir -p ../../data/loc')
      os.system('wget https://www.loc.gov/cds/downloads/MDSConnect/Serials.2014.combined.marc8.gz -O ../../data/loc/Serials.2014.combined.marc8.gz')
      os.system('gunzip ../../data/loc/Serials.2014.combined.marc8.gz')
      spew(datapackage, resources)


parse:
  pipeline:
  - run: parse_marc8_records
    parameters:
      marc8-file-name: ../../data/loc/Serials.2014.combined.marc8
  - run: dump.to_path
    parameters:
      out-path: ../../data/loc/serials
